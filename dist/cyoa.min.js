/*! MJ CYOA - v0.1.0 - 2012-10-15
* https://github.com/motherjones/cyoa
* Copyright (c) 2012 Ben Breedlove; Licensed MIT, GPL */
(function(a){a.Cyoa=function(b,c){var d,e,f,g=[],h,i={start_page:"start",container:"cyoa_container",init:function(){h=this;for(var a in c)h[a]=c[a];h.create_cover();for(var d in b)h.create_page(d);return h.add_to_path(h.start_page),h.display_page(h.start_page),h},create_cover:function(){d=a("#"+h.container),d.addClass("cyoa_container"),d.append(h.create_reset_button_elem()),d.append(h.create_back_button_elem())},create_back_button_elem:function(){return e=a('<button id="cyoa_back_button" class="disabled" value="back">BACK</button>'),e.click(function(){h.back()}),e.addClass("cyoa_top_controls"),e},create_reset_button_elem:function(){return f=a('<button id="cyoa_reset_button" class="disabled" value="reset">RESET</button>'),f.click(function(){h.reset()}),f.addClass("cyoa_top_controls"),f},create_page:function(a){b[a].element=h.create_page_element(a),b[a].element.hide(),d.append(b[a].element)},create_page_element:function(c){var d=b[c],e=d.html?d.html:d.img?'<img src="'+d.img+'" />':d.text?"<p>"+d.text+"</p>":"<p>No content provided.  That's unfortunate",f=a('<div id="'+c+'_container" class="cyoa_page">'+'<div class="cyoa_content">'+e+"</div></div>");return f.append(h.create_selection_buttons(c)),f},add_to_path:function(a){g.push(a),g.length>1&&(e.removeClass("disabled"),f.removeClass("disabled"))},create_selection_buttons:function(c){var d=a('<ul id="'+c+'_controls" class="cyoa_controls"></ul>'),e=b[c].connects;if(!e)return d;var f=function(a,b){b.click(function(){h.add_to_path(a),h.display_page(a)})};for(var g in e){var i=e[g];if(!b[i.link])continue;var j=a('<li class="cyoa_controler_'+i.link+'"></li>');j.append(a("<span>"+i.html+"</span>")),f(i.link,j),d.append(j)}return d},display_page:function(b){return a(".cyoa_page").hide(),a("#"+b+"_container").show(),h},back:function(){if(g.length===1){e.addClass("disabled"),f.addClass("disabled");return}g.pop(),h.display_page(g[g.length-1]),g.length===1&&(e.addClass("disabled"),f.addClass("disabled"))},reset:function(){while(g.length>1)g.pop();h.display_page(g[0]),e.addClass("disabled"),f.addClass("disabled")}};return i.init(b,c)},a.fn.Cyoa=function(b,c){return c=c||{},c.container=this.attr("id"),this.cyoa=a.Cyoa(b,c),this}})(jQuery);